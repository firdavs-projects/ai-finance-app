# üîß –û—Ç–ª–∞–¥–∫–∞ AI Parser - –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**–ü—Ä–æ–±–ª–µ–º–∞**: AI –ø–∞—Ä—Å–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ç–µ–∫—Å—Ç"

---

## üìã Checklist –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Backend

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ backend:**
```bash
cd /Users/firdavsabdulloev/Alif/ai-app
yarn dev:backend
```

**–î–æ–∂–¥–∏—Ç–µ—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
[Nest] LOG Application listening on port 3001
‚úÖ MongoDB connected successfully!
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
- http://localhost:3001/api/docs - Swagger UI
- http://localhost:3001/api/categories - –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### 2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenAI API Key

**–§–∞–π–ª:** `apps/backend/.env`

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞:
cat apps/backend/.env | grep OPENAI_API_KEY

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
OPENAI_API_KEY=sk-...
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∫–ª—é—á–∞:**
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://platform.openai.com/api-keys
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –∞–∫—Ç–∏–≤–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ –∫—Ä–µ–¥–∏—Ç—ã –Ω–∞ –±–∞–ª–∞–Ω—Å–µ

### 3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ MongoDB

**–í –ª–æ–≥–∞—Ö backend –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
‚úÖ MongoDB connected successfully!
üîÑ Initializing default categories...
‚úÖ Default categories initialized
```

**–ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# Connection string –≤ .env:
cat apps/backend/.env | grep MONGODB_URI
```

### 4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ó–∞–ø—Ä–æ—Å –∫ API:**
```bash
curl http://localhost:3001/api/categories
```

**–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å `_id` –ø–æ–ª—è–º–∏:**
```json
[
  {
    "_id": "676c...",
    "name": "–ö–∞—Ñ–µ",
    "type": "expense",
    "icon": "‚òï"
  }
]
```

**–ï—Å–ª–∏ –ø—É—Å—Ç–æ** - —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ Swagger UI (http://localhost:3001/api/docs)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI –ø–∞—Ä—Å–µ—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç

```bash
cd /Users/firdavsabdulloev/Alif/ai-app
./test-ai-parser.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ curl

```bash
curl -X POST http://localhost:3001/api/ai/parse \
  -H "Content-Type: application/json" \
  -d '{"text": "–∞–º–µ—Ä–∏–∫–∞–Ω–æ 25—Å–º–Ω –∏ —á–∏–∑–∫–µ–π–∫ 15—Å–º–Ω"}'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "success": true,
  "transactions": [
    {
      "_id": "...",
      "description": "–∞–º–µ—Ä–∏–∫–∞–Ω–æ",
      "amount": 25,
      "currency": "TJS",
      "type": "expense"
    },
    {
      "_id": "...",
      "description": "—á–∏–∑–∫–µ–π–∫",
      "amount": 15,
      "currency": "TJS",
      "type": "expense"
    }
  ],
  "message": "–°–æ–∑–¥–∞–Ω–æ 2 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Frontend

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5173
2. –ù–∞–π–¥–∏—Ç–µ AI –≤–∏–¥–∂–µ—Ç –≤–Ω–∏–∑—É
3. –í–≤–µ–¥–∏—Ç–µ: `–∞–º–µ—Ä–∏–∫–∞–Ω–æ 25—Å–º–Ω –∏ —á–∏–∑–∫–µ–π–∫ 15—Å–º–Ω`
4. –ù–∞–∂–º–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å
5. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console
6. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–∞ –∫ `/api/ai/parse`

---

## üîç –°–º–æ—Ç—Ä–∏–º –ª–æ–≥–∏ Backend

**–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω backend —É–≤–∏–¥–∏—Ç–µ:**

‚úÖ **–£—Å–ø–µ—à–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥:**
```
ü§ñ AI Parse Request: { text: '–∞–º–µ—Ä–∏–∫–∞–Ω–æ 25—Å–º–Ω', accountId: '...' }
üìã Available categories: 8
‚úÖ AI Response: {"transactions":[...],"needsClarification":false}
üìä Parsed result: {...}
üíæ Creating transaction: { description: '–∞–º–µ—Ä–∏–∫–∞–Ω–æ', amount: 25, ... }
‚úÖ Transaction created: {...}
```

‚ùå **–û—à–∏–±–∫–∞:**
```
ü§ñ AI Parse Request: {...}
‚ùå AI parsing error: Error: ...
Error stack: ...
```

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "API key" error

**–ü—Ä–∏—á–∏–Ω–∞**: OpenAI API key –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `.env` —Ñ–∞–π–ª
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ https://platform.openai.com/usage

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Empty response from AI

**–ü—Ä–∏—á–∏–Ω–∞**: OpenAI –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å OpenAI: https://status.openai.com
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é —Ñ—Ä–∞–∑—É

### –ü—Ä–æ–±–ª–µ–º–∞ 3: MongoDB not connected

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB Atlas

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `MONGODB_URI` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ IP –∞–¥—Ä–µ—Å —Ä–∞–∑—Ä–µ—à—ë–Ω –≤ MongoDB Atlas
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "categoryId is required"

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ fallback –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: `curl http://localhost:3001/api/categories`
2. –°–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º—É–º 1 –∫–∞—Ç–µ–≥–æ—Ä–∏—é expense –∏ 1 income
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

### –ü—Ä–æ–±–ª–µ–º–∞ 5: JSON parse error

**–ü—Ä–∏—á–∏–Ω–∞**: AI –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö backend —Å—Ç—Ä–æ–∫—É "‚úÖ AI Response:"
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–∞–ª–∏–¥–Ω—ã–π –ª–∏ —ç—Ç–æ JSON
3. –ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–º–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—É—é —Ñ—Ä–∞–∑—É

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (—É–∂–µ —Å–¥–µ–ª–∞–Ω—ã)

### 1. –£–ª—É—á—à–µ–Ω –ø—Ä–æ–º–ø—Ç –¥–ª—è AI

**–ë—ã–ª–æ:** –ù–µ—è—Å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏  
**–°—Ç–∞–ª–æ:** –ß—ë—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ + –ø—Ä–∏–º–µ—Ä—ã + –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
- –í—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –û—Ç–≤–µ—Ç –æ—Ç AI
- –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–π JSON
- –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### 3. –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è categoryId

**–ï—Å–ª–∏ AI –Ω–µ –≤–µ—Ä–Ω—É–ª categoryId:**
- –ë–µ—Ä—ë–º –ø–µ—Ä–≤—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –Ω—É–∂–Ω–æ–≥–æ —Ç–∏–ø–∞
- –õ–æ–≥–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

### 4. –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–¢–∏–ø—ã –æ—à–∏–±–æ–∫:**
- API key –ø—Ä–æ–±–ª–µ–º—ã
- Rate limit
- JSON parse –æ—à–∏–±–∫–∏
- –û–±—â–∏–µ –æ—à–∏–±–∫–∏

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ backend** —Å –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ (MongoDB, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å** —á–µ—Ä–µ–∑ curl –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç
4. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏** –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ backend
5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏** –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –∏–º–∏, –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∏–ª–∞—Å—å

---

## üéØ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–∏ —Ñ—Ä–∞–∑—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

‚úÖ **–ü—Ä–æ—Å—Ç—ã–µ:**
```
–∫–æ—Ñ–µ 25—Å–º–Ω
–∞–º–µ—Ä–∏–∫–∞–Ω–æ 22 —Å–æ–º–æ–Ω–∏
—á–∞–π 10—Å
```

‚úÖ **–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–∫—É–ø–æ–∫:**
```
–∞–º–µ—Ä–∏–∫–∞–Ω–æ 25—Å–º–Ω –∏ —á–∏–∑–∫–µ–π–∫ 15—Å–º–Ω
–∫–æ—Ñ–µ 22—Å–º–Ω, –∫—Ä—É–∞—Å–∞–Ω 12—Å–º–Ω, –≤–æ–¥–∞ 5—Å–º–Ω
```

‚úÖ **–î–æ—Ö–æ–¥:**
```
–∑–∞—Ä–ø–ª–∞—Ç–∞ 5000 —Å–æ–º–æ–Ω–∏
—Ñ—Ä–∏–ª–∞–Ω—Å 1000 —Å–º–Ω
```

‚úÖ **–†–∞–∑–Ω—ã–µ –≤–∞–ª—é—Ç—ã:**
```
–∫–æ—Ñ–µ 150 —Ä—É–±–ª–µ–π
–æ–±–µ–¥ 10 –¥–æ–ª–ª–∞—Ä–æ–≤
```

---

**–§–∞–π–ª—ã —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:**
- ‚úÖ `/apps/backend/src/modules/ai/ai.service.ts` - —É–ª—É—á—à–µ–Ω –ø—Ä–æ–º–ø—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ `/test-ai-parser.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `.rules/ai-reports/AI_PARSER_INTEGRATION.md`
- `.rules/business/AI_PARSER_USER_GUIDE.md`

---

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è - –ø—Ä–∏—à–ª–∏—Ç–µ –ª–æ–≥–∏ backend, –∏ –º—ã –Ω–∞–π–¥—ë–º –ø—Ä–∏—á–∏–Ω—É! üîç

